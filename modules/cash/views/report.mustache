<script type="text/javascript" src="{{prefix}}/javascripts/highcharts/highcharts.js"></script>

<script type="text/javascript">
	var chart;
	var params = {{{params}}};
	var x_title = "Expense Over Time";
	var y_title = "Total Expense";
	if (params.accType == "INCOME") {
		x_title = "Income Over Time";
		y_title = "Total Income";
	}
	$(document).ready(function() {
		chart = new Highcharts.Chart({
			chart: {
				renderTo: 'container',
				defaultSeriesType: 'column'
			},
			title: {
				text: x_title
			},
			xAxis: {
				categories: {{{categories}}}
			},
			yAxis: {
				title: {
					text: y_title
				},
				stackLabels: {
					enabled: true,
					style: {
						fontWeight: 'bold',
						color: (Highcharts.theme && Highcharts.theme.textColor) || 'gray'
					},
					formatter : function () {
						return this.total.toFixed(2);
					}
				}
			},
			credits: {
				enabled: true
			},
			tooltip: {
				formatter: function() {
					return '<b>'+this.series.name +'</b>: '+ this.y +'<br/>'+
						 'Total: '+ this.point.stackTotal.toFixed(2);
				}
			},
			plotOptions: {
				column: {
					stacking: 'normal',
					dataLabels: {
						enabled: false,
						color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'white'
					}
				}
			},
			series: {{{series}}}
		});
		
		var form = document.forms.properties;
		form.elements.maxAcc.value=params.maxAcc;
		if (params.accType == "EXPENSE") {
			form.elements.report_type.selectedIndex=0;
		} else {
			form.elements.report_type.selectedIndex=1;
		}
		$("#startDate").datepicker();
		$("#startDate").datepicker('setDate', new Date(params.startDate));
		$("#endDate").datepicker();
		$("#endDate").datepicker('setDate', new Date(params.endDate));
		form.elements.reportName.value=params.reportName;
		$("#openD").click(function(){
			$("#dialog").dialog("open");
		});
		$("#dialog").dialog({
			position: ["center","center"],
			buttons: {
				"apply": function() {
					var f = document.forms.properties;
					var p = {
						startDate : new Date(f.elements.startDate.value).getTime(),
						endDate : new Date(f.elements.endDate.value).getTime(),
						maxAcc : f.elements.maxAcc.value,
						reportType : f.elements.report_type.options[f.elements.report_type.selectedIndex].value,
						reportName : f.elements.reportName.value,
						version: 1
					}
					var jqXHR = $.ajax({
						"type": "POST",
						"data": p,
						"url": "{{prefix}}/report"+location.search,
						"dataType": "text"
					});
					jqXHR.done(function(data){
						location.href=data;
					});
					jqXHR.fail(function(data){
					});
				},
				"close": function() {
					$(this).dialog("close");
				}
			},
			autoOpen: false,
			resizable: false,
			height: 300,
			width: 350,
			modal: true,
			draggable: false
		});
		
		$(".closeTab").on("click", function(e){
		});
	});
</script>
	
<div id="dialog" title="Report settings" style="width: 600; height: 200px;">
	<form name="properties">
		<table>
			<tr>
				<td>start date:</td>
				<td><input type="text" id="startDate" tabindex="-1"></tr>
			</tr>
			<tr>
				<td>end date:</td>
				<td><input type="text" id="endDate" tabindex="-1"></td>
			</tr>
			<tr>
				<td>max account:</td>
				<td><input type="text" id="maxAcc"></td>
			</tr>
			<tr>
				<td>Report name:</td>
				<td><input type="text" id="reportName"></td>
			</tr>
			<tr>
				<td>Select report:</td>
				<td>
					<select name="report_type">
						<option value="EXPENSE">Expense Over Time</option>
						<option value="INCOME">Income Over Time</option>
					</select>
				</td>
			</tr>
		</table>
	</form>
</div>

<a id="openD" href="#">Properties</a>

<div id="container" style="width: 100%; height: 700px;"></div>

