<script type="text/javascript">
$(function() {	
	$(document).on('click','.nav-list .expand-collapse',function(){
		if($(this).hasClass('icon-hand-down')){
			$(this).removeClass('icon-hand-down').addClass('icon-hand-right');
			$(this).parents('li').find('.nav-list').hide();
		}
		else{
			$(this).addClass('icon-hand-down').removeClass('icon-hand-right');
			$(this).parents('li').find('.nav-list').show();
		}
		return false;
	});
	
	$(document).on('click', '#add_new', function(e){		
		$("#ski_createAccount").iframeContainer("open");	
		$("#ski_createAccount").iframeContainer("triggerEvent",{name:'resetAccountDialogData'});		
		return false;
	});
	$("body").on('accountUpdatedSuccess',function(e,data){
		location.reload(true);
		return false;
	});
	$(document).on("click", ".editAcc", function(e){
		var aid = $(this).data('aid');			
		var rpc = new jsonrpc.JsonRpc('/jsonrpc');
		rpc.call('cash.getAccount', '{{token}}', aid, {
			success: function (data) {
				var acc = data[0];								
				$("#ski_createAccount").iframeContainer("triggerEvent",{name:'setAccountDialogData',data:acc});				
			},
			failure: function (reason) {
			},
		});		
		$("#ski_createAccount").iframeContainer("open");
		return false;
	});	
	$("#ski_createAccount").iframeContainer({src:"{{prefix}}/accounts/create",host:"{{host}}"});	
	$("#ski_deleteAccount").iframeContainer({src:"{{prefix}}/accounts/delete",host:"{{host}}"});	
	
	$(document).on("click", ".deleteAcc", function(e){
		var accountId = $(this).data('aid');
		var accName = $('#open'+accountId).text();
		$("#ski_deleteAccount").iframeContainer("triggerEvent",{name:'setAccountDeleteDialogData',data:{_id:accountId,name:accName}});	
		$("#ski_deleteAccount").iframeContainer("open");		
		return false;
	});
	
	$("body").on('accountDeletedSuccess',function(e,id){
		location.reload(true);
	});	
});
</script>
{{>pagesettings}}
<a class="report-settings" href="javascript:void(0);" title="{{#i18n}}Settings{{/i18n}}"></a>
<div id="ski_createAccount"></div>
<div id="ski_deleteAccount"></div>
<a id="add_new" href="javascript:void(0);" class="btn btn-primary">{{#i18n}}Add new account{{/i18n}}</a>
<br><br>
<div id="tree_root" class=" well main tree">
	<ul class="nav nav-list">
	{{#assets}}
		{{>accounts-tree_item}}
	{{/assets}}
	</ul>
</div>
<br><p> * - {{#i18n}}denotes hidden accounts{{/i18n}}</p>

